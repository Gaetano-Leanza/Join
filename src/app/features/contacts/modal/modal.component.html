<form #form="ngForm" (ngSubmit)="saveContact(form)">

  
  @if (visible) {
    <!-- Modal Backdrop -->
    <div class="modal-backdrop" (click)="handleBackdropClick()">

      <!-- Modal Content, Klicks stoppen, damit Backdrop-Klick nicht ausgelöst wird -->
      <div
        class="modal-content"
        [@slideInModal]
        (click)="$event.stopPropagation()"
      >
              <button class="close-button" (click)="handleBackdropClick()">✕</button>

        <div class="content-container">
          <div class="left-panel">
            <div class="wrapper">
              <div class="img-wrapper">
                <img src="/img/Capa 2.svg" alt="join-logo" />
              </div>
              <p>Edit contact</p>
              <div class="line-wrapper">
                <div class="line"></div>
              </div>
            </div>
          </div>

          <div class="right-panel">
            <div class="input-wrapper">
              <div class="left-site">
                @if (!isValidName(name)) {
                  <!-- Avatar Placeholder, wenn Name ungültig -->
                  <div class="avatar-placeholder">
                    <img src="/img/placeholder.svg" alt="Avatar Placeholder" />
                  </div>
                } @else {
                  <!-- Avatar mit Initialen, wenn Name gültig -->
                  <div class="avatar-preview">
                    <div
                      class="avatar"
                      [ngStyle]="{ 'background-color': getAvatarColor(name) }"
                    >
                      {{ getInitials(name) }}
                    </div>
                  </div>
                }
              </div>

              <div class="right-site">
                <div class="right-site-top">
                  <!-- Name Input -->
                  <input
                    class="input input-name"
                    type="text"
                    placeholder="Name"
                    name="name"
                    autocomplete="name"
                    [(ngModel)]="name"
                    #nameRef="ngModel"
                    required
                    pattern="^[A-Za-z\s\-]+$"
                    (ngModelChange)="onInputChange('name', $event)"
                  />
                  @if (nameRef.invalid && nameRef.touched) {
                    <div class="error-text">
                      Please enter a valid name.
                    </div>
                  }

                  <!-- Email Input -->
                  <input
                    class="input input-email"
                    type="email"
                    placeholder="Email"
                    name="email"
                    autocomplete="email"
                    [(ngModel)]="email"
                    #emailRef="ngModel"
                    required
                    pattern="^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$"
                    (ngModelChange)="onInputChange('email', $event)"
                  />
                  @if (emailRef.invalid && emailRef.touched) {
                    <div class="error-text">
                      Please enter a valid email address.
                    </div>
                  }

                  <!-- Phone Input -->
                  <input
                    class="input input-phone"
                    type="tel"
                    placeholder="Phone"
                    name="phone"
                    autocomplete="tel"
                    [(ngModel)]="phone"
                    #phoneRef="ngModel"
                    required
                    pattern="^\+?[0-9\s\-]{7,20}$"
                    (ngModelChange)="onInputChange('phone', $event)"
                  />
                  @if (phoneRef.invalid && phoneRef.touched) {
                    <div class="error-text">
                      Please enter a valid phone number.
                    </div>
                  }

                  <div class="right-site-bottom">
                    <div>
                      <img
                        class="button-left"
                        src="/img/delete-button.svg"
                        alt="delete-button"
                        (click)="resetForm()"
                      />
                    </div>
                    <div>
                      <button type="submit" class="save-button" >
                        <svg
                          width="100"
                          height="61"
                          viewBox="0 0 111 57"
                          fill="none"
                          xmlns="http://www.w3.org/2000/svg"
                        >
                          <rect
                            class="button-background"
                            width="111"
                            height="57"
                            rx="10"
                            fill="#2A3647"
                          />
                          <path
                            class="button-text"
                            d="M26.1033 25.1197C26.0436 24.5181 25.7876 24.0508 25.3352 23.7177C24.8828 23.3846 24.2688 23.218 23.4932 23.218C22.9662 23.218 22.5213 23.2926 22.1583 23.4418C21.7954 23.5859 21.517 23.7873 21.3231 24.0458C21.1342 24.3043 21.0397 24.5977 21.0397 24.9258C21.0298 25.1992 21.087 25.4379 21.2112 25.6417C21.3405 25.8455 21.517 26.022 21.7407 26.1712C21.9644 26.3153 22.223 26.4421 22.5163 26.5515C22.8096 26.6559 23.1228 26.7454 23.4559 26.82L24.8281 27.1481C25.4943 27.2972 26.1058 27.4961 26.6626 27.7447C27.2194 27.9933 27.7017 28.299 28.1093 28.6619C28.517 29.0249 28.8327 29.4524 29.0564 29.9446C29.2851 30.4368 29.4019 31.0011 29.4069 31.6374C29.4019 32.5721 29.1633 33.3825 28.691 34.0685C28.2237 34.7496 27.5475 35.2791 26.6626 35.657C25.7826 36.0298 24.7212 36.2163 23.4783 36.2163C22.2453 36.2163 21.1715 36.0273 20.2567 35.6495C19.3469 35.2717 18.636 34.7124 18.1239 33.9716C17.6168 33.2259 17.3508 32.3036 17.3259 31.2049H20.4506C20.4854 31.717 20.6321 32.1445 20.8906 32.4876C21.1541 32.8256 21.5046 33.0817 21.9421 33.2557C22.3845 33.4247 22.8842 33.5092 23.441 33.5092C23.9879 33.5092 24.4627 33.4297 24.8654 33.2706C25.273 33.1115 25.5887 32.8903 25.8125 32.6069C26.0362 32.3235 26.148 31.9979 26.148 31.63C26.148 31.2869 26.0461 30.9986 25.8423 30.7649C25.6434 30.5312 25.3501 30.3324 24.9623 30.1683C24.5795 30.0043 24.1097 29.8551 23.5529 29.7209L21.8899 29.3033C20.6022 28.9901 19.5855 28.5004 18.8398 27.8342C18.0941 27.168 17.7237 26.2706 17.7286 25.142C17.7237 24.2173 17.9698 23.4094 18.4669 22.7184C18.9691 22.0273 19.6576 21.4879 20.5326 21.1001C21.4076 20.7124 22.4019 20.5185 23.5156 20.5185C24.6491 20.5185 25.6385 20.7124 26.4836 21.1001C27.3338 21.4879 27.995 22.0273 28.4673 22.7184C28.9396 23.4094 29.1832 24.2099 29.1981 25.1197H26.1033ZM34.7856 36.2163C34.0547 36.2163 33.4035 36.0895 32.8317 35.8359C32.26 35.5774 31.8076 35.1971 31.4745 34.695C31.1464 34.1879 30.9823 33.5565 30.9823 32.8008C30.9823 32.1644 31.0991 31.63 31.3328 31.1974C31.5665 30.7649 31.8846 30.4169 32.2873 30.1534C32.69 29.8899 33.1474 29.6911 33.6595 29.5568C34.1765 29.4226 34.7184 29.3281 35.2852 29.2734C35.9514 29.2038 36.4883 29.1392 36.896 29.0795C37.3037 29.0149 37.5995 28.9205 37.7834 28.7962C37.9674 28.6719 38.0593 28.4879 38.0593 28.2443V28.1996C38.0593 27.7273 37.9102 27.3619 37.6119 27.1033C37.3186 26.8448 36.901 26.7156 36.3591 26.7156C35.7873 26.7156 35.3324 26.8423 34.9944 27.0959C34.6563 27.3445 34.4326 27.6577 34.3232 28.0355L31.385 27.7969C31.5341 27.1009 31.8275 26.4993 32.265 25.9922C32.7025 25.4801 33.2667 25.0874 33.9578 24.8139C34.6538 24.5355 35.4592 24.3963 36.374 24.3963C37.0103 24.3963 37.6194 24.4709 38.201 24.62C38.7877 24.7692 39.3072 25.0004 39.7596 25.3136C40.217 25.6268 40.5775 26.0295 40.841 26.5217C41.1044 27.0089 41.2362 27.593 41.2362 28.2741V36H38.2234V34.4116H38.1339C37.95 34.7695 37.7039 35.0852 37.3956 35.3587C37.0874 35.6271 36.717 35.8384 36.2845 35.9925C35.852 36.1417 35.3523 36.2163 34.7856 36.2163ZM35.6954 34.0238C36.1627 34.0238 36.5753 33.9318 36.9333 33.7479C37.2912 33.5589 37.5721 33.3054 37.776 32.9872C37.9798 32.669 38.0817 32.3086 38.0817 31.9059V30.6903C37.9823 30.755 37.8456 30.8146 37.6716 30.8693C37.5025 30.919 37.3111 30.9663 37.0973 31.011C36.8836 31.0508 36.6698 31.0881 36.456 31.1229C36.2422 31.1527 36.0483 31.18 35.8743 31.2049C35.5015 31.2596 35.1758 31.3466 34.8974 31.4659C34.619 31.5852 34.4027 31.7468 34.2486 31.9506C34.0945 32.1495 34.0174 32.3981 34.0174 32.6964C34.0174 33.1289 34.1741 33.4595 34.4873 33.6882C34.8054 33.9119 35.2081 34.0238 35.6954 34.0238ZM53.9697 24.5455L49.9651 36H46.3855L42.3809 24.5455H45.7367L48.1156 32.7411H48.235L50.6064 24.5455H53.9697ZM60.4464 36.2237C59.2682 36.2237 58.254 35.9851 57.4038 35.5078C56.5586 35.0256 55.9074 34.3445 55.45 33.4645C54.9926 32.5795 54.7639 31.533 54.7639 30.3249C54.7639 29.1467 54.9926 28.1126 55.45 27.2227C55.9074 26.3327 56.5512 25.6392 57.3814 25.142C58.2167 24.6449 59.1961 24.3963 60.3196 24.3963C61.0753 24.3963 61.7788 24.5181 62.4301 24.7617C63.0863 25.0004 63.6581 25.3608 64.1453 25.843C64.6375 26.3253 65.0203 26.9318 65.2937 27.6626C65.5672 28.3885 65.7039 29.2386 65.7039 30.2131V31.0856H56.0316V29.1168H62.7135C62.7135 28.6594 62.614 28.2543 62.4152 27.9013C62.2163 27.5483 61.9404 27.2724 61.5874 27.0735C61.2394 26.8697 60.8342 26.7678 60.3718 26.7678C59.8896 26.7678 59.462 26.8796 59.0892 27.1033C58.7213 27.3221 58.4329 27.6179 58.2241 27.9908C58.0153 28.3587 57.9084 28.7688 57.9035 29.2212V31.093C57.9035 31.6598 58.0079 32.1495 58.2167 32.5621C58.4304 32.9748 58.7312 33.293 59.119 33.5167C59.5068 33.7404 59.9667 33.8523 60.4986 33.8523C60.8516 33.8523 61.1748 33.8026 61.4681 33.7031C61.7614 33.6037 62.0125 33.4545 62.2213 33.2557C62.4301 33.0568 62.5892 32.8132 62.6986 32.5249L65.6368 32.7188C65.4876 33.4247 65.1819 34.0412 64.7195 34.5682C64.2621 35.0902 63.6705 35.4979 62.9446 35.7912C62.2238 36.0795 61.391 36.2237 60.4464 36.2237Z"
                            fill="white"
                          />
                          <mask
                            id="mask0_48005_7663"
                            style="mask-type: alpha"
                            maskUnits="userSpaceOnUse"
                            x="71"
                            y="16"
                            width="24"
                            height="25"
                          >
                            <rect
                              x="71"
                              y="16.5"
                              width="24"
                              height="24"
                              fill="#D9D9D9"
                            />
                          </mask>
                          <g mask="url(#mask0_48005_7663)">
                            <path
                              class="button-checkmark"
                              d="M80.5506 31.65L89.0256 23.175C89.2256 22.975 89.4631 22.875 89.7381 22.875C90.0131 22.875 90.2506 22.975 90.4506 23.175C90.6506 23.375 90.7506 23.6125 90.7506 23.8875C90.7506 24.1625 90.6506 24.4 90.4506 24.6L81.2506 33.8C81.0506 34 80.8172 34.1 80.5506 34.1C80.2839 34.1 80.0506 34 79.8506 33.8L75.5506 29.5C75.3506 29.3 75.2547 29.0625 75.2631 28.7875C75.2714 28.5125 75.3756 28.275 75.5756 28.075C75.7756 27.875 76.0131 27.775 76.2881 27.775C76.5631 27.775 76.8006 27.875 77.0006 28.075L80.5506 31.65Z"
                              fill="white"
                            />
                          </g>
                        </svg>
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  }
</form>