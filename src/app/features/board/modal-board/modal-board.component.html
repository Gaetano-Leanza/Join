<!-- Task Modal -->
<div class="task-modal" (click)="close.emit()">
    <div class="modal-content" (click)="$event.stopPropagation()">
        <button id="close" (click)="close.emit()">X</button>
        <span class="text" id="categoryColor" [style.background-color]="task.categoryColor">
            {{ task.category }}
        </span><br>
        <h3>{{ task.title }}</h3>
        <span class="content">{{ task.description }}</span><br>
        <span class="text-grey">Due Date: </span> <span class="content"> {{ task.dueDate }}</span><br>
        <span class="text-grey"> Priority: </span>{{ task.priority }}
        <span class="task-priority-icon" [ngSwitch]="task.priority">
            <svg *ngSwitchCase="'medium'" width="24" height="24" viewBox="0 0 24 24" fill="none"
                xmlns="http://www.w3.org/2000/svg">
                <rect x="4" y="11" width="16" height="2" rx="1" fill="#FFA800" />
                <rect x="4" y="15" width="16" height="2" rx="1" fill="#FFA800" />
            </svg>
            <svg *ngSwitchCase="'urgent'" width="24" height="24" viewBox="0 0 24 24" fill="none"
                xmlns="http://www.w3.org/2000/svg">
                <path d="M7 14L12 9L17 14" stroke="#FF3D00" stroke-width="2" stroke-linecap="round"
                    stroke-linejoin="round" />
                <path d="M7 18L12 13L17 18" stroke="#FF3D00" stroke-width="2" stroke-linecap="round"
                    stroke-linejoin="round" />
            </svg>
            <svg *ngSwitchCase="'low'" width="24" height="24" viewBox="0 0 24 24" fill="none"
                xmlns="http://www.w3.org/2000/svg">
                <path d="M7 10L12 15L17 10" stroke="#7AE229" stroke-width="2" stroke-linecap="round"
                    stroke-linejoin="round" />
                <path d="M7 6L12 11L17 6" stroke="#7AE229" stroke-width="2" stroke-linecap="round"
                    stroke-linejoin="round" />
            </svg>
        </span><br>

        <span class="text-grey">Assigned To:</span><br>
        <!-- NEW: show primary contact (first) with avatar + name, others below in a column -->
        <div class="assigned-contacts" *ngIf="task.contacts?.length">
            <!-- Primary contact -->
            <div class="primary-contact" *ngIf="task.contacts.length > 0">
                <div class="contact-row">
                    <div class="avatar" [style.background-color]="getAvatarColor(task.contacts[0])">
                        {{ getInitials(task.contacts[0]) }}
                    </div>
                    <div class="contact-name">
                        {{ task.contacts[0] }}
                    </div>
                </div>
            </div>

            <!-- Other contacts stacked in a column -->
            <div class="other-contacts" *ngIf="task.contacts.length > 1">
                <div class="contact-row" *ngFor="let contact of task.contacts; let i = index">
                    <ng-container *ngIf="i > 0">
                        <div class="avatar small" [style.background-color]="getAvatarColor(contact)">
                            {{ getInitials(contact) }}
                        </div>
                        <div class="contact-name small">
                            {{ contact }}
                        </div>
                    </ng-container>
                </div>
            </div>
        </div>

        <span class="text-grey">Subtasks</span><br>
        <div *ngFor="let subtask of task.subtasks">
            <input class="subtask-checkbox" type="checkbox" [checked]="subtask.done">
            <span class="content">{{ subtask.title }}</span>

        </div>



        <div class="task-modal-buttons">

            <!-- Delete button -->
            <svg (click)="onDeleteTask()" width="82" height="25" viewBox="0 0 82 25" xmlns="http://www.w3.org/2000/svg">
                <mask id="mask0_75609_16272" style="mask-type:alpha" maskUnits="userSpaceOnUse" x="0" y="0" width="25"
                    height="25">
                    <rect x="0.682129" y="0.396729" width="24" height="24" />
                </mask>
                <g mask="url(#mask0_75609_16272)">
                    <path
                        d="M7.68213 21.3967C7.13213 21.3967 6.6613 21.2009 6.26963 20.8092C5.87796 20.4176 5.68213 19.9467 5.68213 19.3967V6.39673C5.3988 6.39673 5.1613 6.3009 4.96963 6.10923C4.77796 5.91756 4.68213 5.68006 4.68213 5.39673C4.68213 5.1134 4.77796 4.8759 4.96963 4.68423C5.1613 4.49256 5.3988 4.39673 5.68213 4.39673H9.68213C9.68213 4.1134 9.77796 3.8759 9.96963 3.68423C10.1613 3.49256 10.3988 3.39673 10.6821 3.39673H14.6821C14.9655 3.39673 15.203 3.49256 15.3946 3.68423C15.5863 3.8759 15.6821 4.1134 15.6821 4.39673H19.6821C19.9655 4.39673 20.203 4.49256 20.3946 4.68423C20.5863 4.8759 20.6821 5.1134 20.6821 5.39673C20.6821 5.68006 20.5863 5.91756 20.3946 6.10923C20.203 6.3009 19.9655 6.39673 19.6821 6.39673V19.3967C19.6821 19.9467 19.4863 20.4176 19.0946 20.8092C18.703 21.2009 18.2321 21.3967 17.6821 21.3967H7.68213ZM7.68213 6.39673V19.3967H17.6821V6.39673H7.68213ZM9.68213 16.3967C9.68213 16.6801 9.77796 16.9176 9.96963 17.1092C10.1613 17.3009 10.3988 17.3967 10.6821 17.3967C10.9655 17.3967 11.203 17.3009 11.3946 17.1092C11.5863 16.9176 11.6821 16.6801 11.6821 16.3967V9.39673C11.6821 9.1134 11.5863 8.8759 11.3946 8.68423C11.203 8.49256 10.9655 8.39673 10.6821 8.39673C10.3988 8.39673 10.1613 8.49256 9.96963 8.68423C9.77796 8.8759 9.68213 9.1134 9.68213 9.39673V16.3967ZM13.6821 16.3967C13.6821 16.6801 13.778 16.9176 13.9696 17.1092C14.1613 17.3009 14.3988 17.3967 14.6821 17.3967C14.9655 17.3967 15.203 17.3009 15.3946 17.1092C15.5863 16.9176 15.6821 16.6801 15.6821 16.3967V9.39673C15.6821 9.1134 15.5863 8.8759 15.3946 8.68423C15.203 8.49256 14.9655 8.39673 14.6821 8.39673C14.3988 8.39673 14.1613 8.49256 13.9696 8.68423C13.778 8.8759 13.6821 9.1134 13.6821 9.39673V16.3967Z" />
                </g>
                <path
                    d="M37.6821 17.8967H34.0912V6.26036H37.8412C38.97 6.26036 39.9359 6.49332 40.7389 6.95923C41.542 7.42135 42.1575 8.08612 42.5855 8.95355C43.0136 9.81718 43.2276 10.8513 43.2276 12.0558C43.2276 13.2679 43.0117 14.3115 42.5799 15.1865C42.148 16.0577 41.5193 16.7282 40.6935 17.1979C39.8677 17.6638 38.8639 17.8967 37.6821 17.8967ZM35.5003 16.6467H37.5912C38.5533 16.6467 39.3507 16.4611 39.9833 16.0899C40.6158 15.7187 41.0874 15.1903 41.398 14.5047C41.7086 13.8191 41.8639 13.0028 41.8639 12.0558C41.8639 11.1164 41.7105 10.3077 41.4037 9.62968C41.0969 8.94786 40.6386 8.42514 40.0287 8.0615C39.4189 7.69408 38.6594 7.51036 37.7503 7.51036H35.5003V16.6467ZM49.0685 18.0785C48.2276 18.0785 47.5022 17.8929 46.8924 17.5217C46.2863 17.1467 45.8185 16.624 45.4889 15.9535C45.1632 15.2793 45.0003 14.4952 45.0003 13.6013C45.0003 12.7073 45.1632 11.9195 45.4889 11.2376C45.8185 10.552 46.2768 10.0179 46.8639 9.63536C47.4549 9.249 48.1443 9.05582 48.9321 9.05582C49.3867 9.05582 49.8355 9.13158 50.2787 9.28309C50.7219 9.43461 51.1253 9.68082 51.4889 10.0217C51.8526 10.3588 52.1424 10.8058 52.3583 11.3626C52.5742 11.9195 52.6821 12.6051 52.6821 13.4195V13.9876H45.9549V12.8285H51.3185C51.3185 12.3361 51.22 11.8967 51.023 11.5104C50.8299 11.124 50.5533 10.8191 50.1935 10.5956C49.8374 10.3721 49.417 10.2604 48.9321 10.2604C48.398 10.2604 47.9359 10.3929 47.5458 10.6581C47.1594 10.9195 46.8621 11.2604 46.6537 11.6808C46.4454 12.1013 46.3412 12.552 46.3412 13.0331V13.8058C46.3412 14.4649 46.4549 15.0236 46.6821 15.482C46.9132 15.9365 47.2333 16.2831 47.6424 16.5217C48.0514 16.7566 48.5268 16.874 49.0685 16.874C49.4208 16.874 49.7389 16.8248 50.023 16.7263C50.3109 16.624 50.559 16.4725 50.7674 16.2717C50.9757 16.0672 51.1367 15.8134 51.2503 15.5104L52.5458 15.874C52.4094 16.3134 52.1802 16.6998 51.8583 17.0331C51.5363 17.3626 51.1386 17.6202 50.6651 17.8058C50.1916 17.9876 49.6594 18.0785 49.0685 18.0785ZM56.0628 6.26036V17.8967H54.7219V6.26036H56.0628ZM62.1779 18.0785C61.337 18.0785 60.6116 17.8929 60.0017 17.5217C59.3957 17.1467 58.9279 16.624 58.5983 15.9535C58.2726 15.2793 58.1097 14.4952 58.1097 13.6013C58.1097 12.7073 58.2726 11.9195 58.5983 11.2376C58.9279 10.552 59.3862 10.0179 59.9733 9.63536C60.5642 9.249 61.2536 9.05582 62.0415 9.05582C62.496 9.05582 62.9449 9.13158 63.3881 9.28309C63.8313 9.43461 64.2347 9.68082 64.5983 10.0217C64.962 10.3588 65.2517 10.8058 65.4676 11.3626C65.6835 11.9195 65.7915 12.6051 65.7915 13.4195V13.9876H59.0642V12.8285H64.4279C64.4279 12.3361 64.3294 11.8967 64.1324 11.5104C63.9392 11.124 63.6627 10.8191 63.3029 10.5956C62.9468 10.3721 62.5264 10.2604 62.0415 10.2604C61.5074 10.2604 61.0453 10.3929 60.6551 10.6581C60.2688 10.9195 59.9714 11.2604 59.7631 11.6808C59.5548 12.1013 59.4506 12.552 59.4506 13.0331V13.8058C59.4506 14.4649 59.5642 15.0236 59.7915 15.482C60.0226 15.9365 60.3426 16.2831 60.7517 16.5217C61.1608 16.7566 61.6362 16.874 62.1779 16.874C62.5301 16.874 62.8483 16.8248 63.1324 16.7263C63.4203 16.624 63.6684 16.4725 63.8767 16.2717C64.0851 16.0672 64.246 15.8134 64.3597 15.5104L65.6551 15.874C65.5188 16.3134 65.2896 16.6998 64.9676 17.0331C64.6457 17.3626 64.2479 17.6202 63.7745 17.8058C63.301 17.9876 62.7688 18.0785 62.1779 18.0785ZM71.6267 9.16946V10.3058H67.104V9.16946H71.6267ZM68.4222 7.07855H69.7631V15.3967C69.7631 15.7755 69.818 16.0596 69.9279 16.249C70.0415 16.4346 70.1854 16.5596 70.3597 16.624C70.5377 16.6846 70.7252 16.7149 70.9222 16.7149C71.0699 16.7149 71.1911 16.7073 71.2858 16.6922C71.3805 16.6732 71.4563 16.6581 71.5131 16.6467L71.7858 17.8513C71.6949 17.8854 71.568 17.9195 71.4051 17.9535C71.2423 17.9914 71.0358 18.0104 70.7858 18.0104C70.407 18.0104 70.0358 17.9289 69.6722 17.766C69.3123 17.6032 69.0131 17.3551 68.7745 17.0217C68.5396 16.6884 68.4222 16.2679 68.4222 15.7604V7.07855ZM77.2091 18.0785C76.3682 18.0785 75.6428 17.8929 75.033 17.5217C74.4269 17.1467 73.9591 16.624 73.6296 15.9535C73.3038 15.2793 73.1409 14.4952 73.1409 13.6013C73.1409 12.7073 73.3038 11.9195 73.6296 11.2376C73.9591 10.552 74.4175 10.0179 75.0046 9.63536C75.5955 9.249 76.2849 9.05582 77.0728 9.05582C77.5273 9.05582 77.9762 9.13158 78.4193 9.28309C78.8625 9.43461 79.2659 9.68082 79.6296 10.0217C79.9932 10.3588 80.283 10.8058 80.4989 11.3626C80.7148 11.9195 80.8228 12.6051 80.8228 13.4195V13.9876H74.0955V12.8285H79.4591C79.4591 12.3361 79.3606 11.8967 79.1637 11.5104C78.9705 11.124 78.694 10.8191 78.3341 10.5956C77.9781 10.3721 77.5576 10.2604 77.0728 10.2604C76.5387 10.2604 76.0765 10.3929 75.6864 10.6581C75.3 10.9195 75.0027 11.2604 74.7943 11.6808C74.586 12.1013 74.4818 12.552 74.4818 13.0331V13.8058C74.4818 14.4649 74.5955 15.0236 74.8228 15.482C75.0538 15.9365 75.3739 16.2831 75.783 16.5217C76.1921 16.7566 76.6675 16.874 77.2091 16.874C77.5614 16.874 77.8796 16.8248 78.1637 16.7263C78.4515 16.624 78.6996 16.4725 78.908 16.2717C79.1163 16.0672 79.2773 15.8134 79.3909 15.5104L80.6864 15.874C80.55 16.3134 80.3209 16.6998 79.9989 17.0331C79.6769 17.3626 79.2792 17.6202 78.8057 17.8058C78.3322 17.9876 77.8 18.0785 77.2091 18.0785Z" />
            </svg>

            <!-- Edit button -->
            <svg (click)="showEditModal = true" width="63" height="25" viewBox="0 0 63 25" fill="none"
                xmlns="http://www.w3.org/2000/svg">
                <mask id="mask0_75609_16274" style="mask-type:alpha" maskUnits="userSpaceOnUse" x="0" y="0" width="25"
                    height="25">
                    <rect x="0.682129" y="0.396729" width="24" height="24" />
                </mask>
                <g mask="url(#mask0_75609_16274)">
                    <path
                        d="M5.68213 19.3967H7.08213L15.7071 10.7717L14.3071 9.37173L5.68213 17.9967V19.3967ZM19.9821 9.32173L15.7321 5.12173L17.1321 3.72173C17.5155 3.3384 17.9863 3.14673 18.5446 3.14673C19.103 3.14673 19.5738 3.3384 19.9571 3.72173L21.3571 5.12173C21.7405 5.50506 21.9405 5.96756 21.9571 6.50923C21.9738 7.0509 21.7905 7.5134 21.4071 7.89673L19.9821 9.32173ZM18.5321 10.7967L7.93213 21.3967H3.68213V17.1467L14.2821 6.54673L18.5321 10.7967Z" />
                </g>
                <path
                    d="M34.0912 17.8967V6.26036H41.1139V7.51036H35.5003V11.4422H40.7503V12.6922H35.5003V16.6467H41.2049V17.8967H34.0912ZM46.7674 18.0785C46.0401 18.0785 45.398 17.8948 44.8412 17.5274C44.2844 17.1562 43.8488 16.6335 43.5344 15.9592C43.22 15.2812 43.0628 14.4801 43.0628 13.5558C43.0628 12.6392 43.22 11.8437 43.5344 11.1695C43.8488 10.4952 44.2863 9.97438 44.8469 9.60696C45.4075 9.23953 46.0552 9.05582 46.7901 9.05582C47.3583 9.05582 47.8071 9.15052 48.1367 9.33991C48.47 9.52552 48.7238 9.73764 48.898 9.97627C49.0761 10.2111 49.2143 10.4043 49.3128 10.5558H49.4264V6.26036H50.7674V17.8967H49.4719V16.5558H49.3128C49.2143 16.7149 49.0742 16.9157 48.8924 17.1581C48.7105 17.3967 48.4511 17.6107 48.1139 17.8001C47.7768 17.9857 47.328 18.0785 46.7674 18.0785ZM46.9492 16.874C47.4871 16.874 47.9416 16.7338 48.3128 16.4535C48.684 16.1695 48.9662 15.7774 49.1594 15.2774C49.3526 14.7736 49.4492 14.1922 49.4492 13.5331C49.4492 12.8816 49.3545 12.3115 49.1651 11.8229C48.9757 11.3304 48.6954 10.9479 48.3242 10.6751C47.953 10.3986 47.4946 10.2604 46.9492 10.2604C46.381 10.2604 45.9075 10.4062 45.5287 10.6979C45.1537 10.9857 44.8715 11.3778 44.6821 11.874C44.4965 12.3664 44.4037 12.9195 44.4037 13.5331C44.4037 14.1543 44.4984 14.7187 44.6878 15.2263C44.881 15.7301 45.1651 16.1316 45.5401 16.4308C45.9189 16.7263 46.3886 16.874 46.9492 16.874ZM53.4094 17.8967V9.16946H54.7503V17.8967H53.4094ZM54.0912 7.71491C53.8299 7.71491 53.6045 7.6259 53.4151 7.44786C53.2295 7.26983 53.1367 7.05582 53.1367 6.80582C53.1367 6.55582 53.2295 6.3418 53.4151 6.16377C53.6045 5.98574 53.8299 5.89673 54.0912 5.89673C54.3526 5.89673 54.5761 5.98574 54.7617 6.16377C54.9511 6.3418 55.0458 6.55582 55.0458 6.80582C55.0458 7.05582 54.9511 7.26983 54.7617 7.44786C54.5761 7.6259 54.3526 7.71491 54.0912 7.71491ZM61.0017 9.16946V10.3058H56.479V9.16946H61.0017ZM57.7972 7.07855H59.1381V15.3967C59.1381 15.7755 59.193 16.0596 59.3029 16.249C59.4165 16.4346 59.5604 16.5596 59.7347 16.624C59.9127 16.6846 60.1002 16.7149 60.2972 16.7149C60.4449 16.7149 60.5661 16.7073 60.6608 16.6922C60.7555 16.6732 60.8313 16.6581 60.8881 16.6467L61.1608 17.8513C61.0699 17.8854 60.943 17.9195 60.7801 17.9535C60.6173 17.9914 60.4108 18.0104 60.1608 18.0104C59.782 18.0104 59.4108 17.9289 59.0472 17.766C58.6873 17.6032 58.3881 17.3551 58.1495 17.0217C57.9146 16.6884 57.7972 16.2679 57.7972 15.7604V7.07855Z" />
            </svg>

        </div>
    </div>
</div>

<app-board-modal-edit *ngIf="showEditModal" [task]="task" (close)="closeEditModal()">
</app-board-modal-edit>